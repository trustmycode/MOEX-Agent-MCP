---
id: TASK-2025-085
title: "Фаза 0.5.3. Регрессионные тесты и документация по миграции на moex_iss_sdk"
status: backlog
priority: medium
type: chore
estimate: 6h
assignee: @unassigned
created: 2025-12-10
updated: 2025-12-10
parents: [TASK-2025-074]
arch_refs: [ARCH-sdk-moex-iss, ARCH-mcp-moex-iss]
risk: low
benefit: "Снижает риск регрессий при переходе moex-iss-mcp на общий SDK за счёт тестов и обновлённой документации."
audit_log:
  - {date: 2025-12-10, user: "@AI-DocArchitect", action: "created with status backlog"}
---

## Описание

Дополнить/обновить тесты MCP и документацию так, чтобы миграция на
`moex_iss_sdk.IssClient` была прозрачно зафиксирована и проверяема.

Необходимо сравнить поведение MCP до и после миграции на SDK на наборе
типовых сценариев и обновить архитектурные документы, отражающие новый
слой SDK.

## Критерии приемки

- Добавлены или обновлены интеграционные тесты MCP, которые:
  - поднимают MCP с использованием `moex_iss_sdk`;
  - выполняют вызовы `get_security_snapshot`, `get_ohlcv_timeseries`,
    `get_index_constituents_metrics` на фиксированных тестовых данных;
  - сравнивают ключевые поля ответов с эталонными значениями (или
    сохранёнными снапшотами).
- В `docs/ARCHITECTURE.md` и/или `ARCH-mcp-moex-iss-v1.md` отражено,
  что MCP использует общий SDK (`ARCH-sdk-moex-iss`) вместо собственного
  HTTP-клиента.
- При необходимости обновлён SPEC или README с упоминанием SDK как
  отдельного слоя.

## Определение готовности

- Любые будущие изменения в SDK, влияющие на поведение MCP, будут
  диагностированы регрессионными тестами.

## Заметки

- При наличии ограничений по времени можно начать с smoke-тестов и
  минимальных проверок полей, расширяя покрытие по мере развития
  проекта.

