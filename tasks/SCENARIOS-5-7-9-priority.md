# Roadmap задач для сценариев 5 / 7 / 9

## 1. Как читать эту таблицу

- **Цель файла**: дать линейный порядок задач, который позволяет по шагам реализовать функционал сценариев **5 (issuer_peers_compare)**, **7 (portfolio_risk + ребалансировка)** и **9 (cfo_liquidity_report)**.
- **Колонка `#`** — рекомендуемая последовательность выполнения (от самых критичных к менее важным / roadmap).
- **Колонка `Сценарии`** — какие сценарии в первую очередь выигрывают от задачи.
- **Приоритет**:
  - **P0** — критично для базового функционала 5/7/9 (MVP хакатона).
  - **P0.5** — сильно усиливает демо/ценность, но теоретически можно сдвинуть после P0.
  - **P1/P2** — улучшения и roadmap после устойчивого MVP.

## 2. Упорядоченный список задач

> Примечание: добавлена колонка `Статус`, отражающая текущее состояние задачи по файлам в директории `tasks/` (`done` / `backlog` / `planned`).

| # | ID задачи | Название (кратко) | Сценарии | Роль в 5/7/9 | Приоритет | Статус |
|---|-----------|-------------------|----------|--------------|-----------|--------|
| 1 | `TASK-2025-001` | Фаза 0. Требования и стек моделей | 5/7/9 | Зафиксировать LLM-модели, правила по датам и индексам для всего решения | P0 | done |
| 2 | `TASK-2025-073` | Фаза 0.4. Проектирование API `moex_iss_sdk` | 5/7/9 | Спроектировать единый `IssClient` и модели для данных ISS, на которые опираются все MCP | P0 | done |
| 3 | `TASK-2025-074` | Фаза 0.5. Вынесение IssClient в `moex_iss_sdk` | 5/7/9 | Перенести существующий HTTP-клиент ISS в SDK, убрать дублирование | P0 | done |
| 4 | `TASK-2025-075` | Фаза 0.6. Кэш и ошибки в `moex_iss_sdk` | 5/7/9 | Добавить LRU-кэш и нормализованные исключения (`INVALID_TICKER`, `DATE_RANGE_TOO_LARGE`, …) | P0 | done |
| 5 | `TASK-2025-002` | Фаза 1. Базовый MCP `moex-iss-mcp` | 5/7/9 | Реализовать основной MCP над ISS (snapshot, OHLCV, индекс), на который опираются все сценарии | P0 | done |
| 6 | `TASK-2025-076` | Фаза 2.1. Каркас `risk-analytics-mcp` | 7/9 | Создать отдельный MCP-сервер риск-аналитики с `/mcp`/`/health`/`/metrics` | P0 | done |
| 7 | `TASK-2025-077` | Фаза 2.2. Tool `compute_portfolio_risk_basic` | 7/9 | Реализовать базовый портфельный риск (доходности, вола, концентрации, max drawdown) | P0 | done |
| 8 | `TASK-2025-103` | Стресс-сценарии и Var_light | 7/9 | Добавить фиксированные стрессы и Var_light в ответ `portfolio_risk` для риск-менеджера и CFO | P0 | done |
| 9 | `TASK-2025-078` | Фаза 2.3. Tool `compute_correlation_matrix` | 7 | Построение матрицы корреляций для top-N бумаг портфеля и drill-down-анализа | P0 | done |
| 10 | `TASK-2025-079` | Фаза 2.4. SPEC и `tools.json` для `risk-analytics-mcp` | 5/7/9 | Формализовать JSON Schema и `tools.json` для risk-analytics-mcp (портфельный риск и корреляции) | P0 | done |
| 11 | `TASK-2025-102` | Источник фундаментала `FundamentalsDataProvider` | 5/7/9 | Абстракция для фундаментальных/CFO-метрик (выручка, EBITDA, долг, мультипликаторы) поверх ISS | P0 | done |
| 12 | `TASK-2025-108` | MCP-tool `issuer_peers_compare` в `risk-analytics-mcp` | 5 | Реализовать инструмент сравнения эмитента с пирами по фундаменталу и мультипликаторам | P0 | planned |
| 13 | `TASK-2025-109` | SPEC и `tools.json` для `issuer_peers_compare` | 5 | Описать JSON Schema и добавить инструмент в `tools.json` risk-analytics-mcp | P0 | planned |
| 14 | `TASK-2025-101` | Tool `suggest_rebalance` в `risk-analytics-mcp` | 7 | Реализовать детерминированную эвристику ребалансировки (таргет-профиль, лимиты, max turnover) | P0 | planned |
| 15 | `TASK-2025-105` | `cfo_liquidity_report` и A2A-JSON | 9 | Сформировать структурированный `CfoLiquidityReport` поверх ядра `portfolio_risk` и стрессов | P0 | planned |
| 16 | `TASK-2025-003` | Фаза 2. AI-агент A2A MVP | 5/7/9 | Реализовать A2A-агента: A2A-модели, LLM-клиент, MCP-клиент, оркестратор, форматтер ответа | P0 | backlog |
| 17 | `TASK-2025-046` | Фаза P0. Basic-планировщик и лимиты | 5/7/9 | Ввести basic-режим планировщика с лимитами на шаги, LLM-вызовы, период и размер портфеля | P0 | backlog |
| 18 | `TASK-2025-104` | Планировщик P0 на основе `ScenarioTemplate` (5/7/9) | 5/7/9 | Реализовать выбор сценариев 5/7/9 по намерению и фиксированные цепочки MCP-вызовов | P0 | planned |
| 19 | `TASK-2025-049` | Фаза PC. Сценарии, шаблоны и `portfolio_risk` | 7 | Формализовать `scenario_type`, `ScenarioTemplate` для портфеля и шаг `limit_portfolio` для больших портфелей | P0.5 | backlog |
| 20 | `TASK-2025-004` | Фаза 3. Инфраструктура и деплой | 5/7/9 | Docker-образы, `docker-compose`, smoke-тесты и деплой MCP+агента в Evolution AI Agents | P0.5 | backlog |
| 21 | `TASK-2025-006` | Фаза 5. Web-UI поверх A2A | 5/7/9 | Простой веб-дашборд для демонстрации сценариев 5/7/9 (текст, таблицы, графики) | P0.5 | backlog |
| 22 | `TASK-2025-107` | Демонстрационные сценарии и сторителлинг | 5/7/9 | Подготовить демо-скрипты, тестовый портфель и инструкцию «How to demo» для жюри и стейкхолдеров | P0.5 | planned |
| 23 | `TASK-2025-007` | Фаза 6. Расширенные MCP-инструменты и портфельный анализ | 7 | Расширить портфельные инструменты (multi-OHLCV, portfolio metrics, beta и пр.) сверх базового риска | P1 | backlog |
| 24 | `TASK-2025-005` | Фаза 4. RAG MCP — методологии и гайды | 5/7/9 | Добавить RAG MCP для методик/гайдов, чтобы агент лучше объяснял метрики и решения | P1 | backlog |
| 25 | `TASK-2025-106` | RAG-расширения как интерфейс (без реализации в MVP) | 5/7/9 | Спроектировать интерфейс `TextualContextProvider` и точки расширения под RAG | P1 | planned |
| 26 | `TASK-2025-047` | Фаза PA. Расширяемая архитектура планировщика | 5/7/9 | Ввести `PlanningStrategy`, `ToolRegistry` и телеметрию планировщика для future advanced-режимов | P2 | backlog |
| 27 | `TASK-2025-048` | Фаза PB. Re-planning v2 и AdvancedPlanningStrategy | 5/7/9 | Добавить advanced re-plan с LLM-поддержкой и `PlanExecutionResult` (поверх basic-режима) | P2 | backlog |
| 28 | `TASK-2025-050` | Фаза PD. Внешний Planner Agent (roadmap) | 5/7/9 | Спроектировать внешний Planner Agent и стратегию `ExternalAgentPlanningStrategy` с fallback | P2 | backlog |
| 29 | `TASK-2025-051` | Фаза PE. Production-grade-функции планировщика | 5/7/9 | Cost-aware планирование, feedback-loop по планам, валидатор и YAML-DSL сценариев | P2 | backlog |
| 30 | `TASK-2025-008` | Фаза 7. Расширенный риск-анализ и RAG Phase 2 | 7/9 | Документировать advanced-метрики (VaR, stress-tests, beta, `portfolio_stress_test`) и RAG Phase 2 | P2 | backlog |

## 2.1. Дополнительные задачи по Risk Dashboard, RAG и голосу (расширение плана)

| # | ID задачи | Название (кратко) | Сценарии | Роль в 5/7/9 | Приоритет | Статус |
|---|-----------|-------------------|----------|--------------|-----------|--------|
| 31 | `TASK-2025-110` | Risk Dashboard и DashboardSubagent | 7/9 | Реализовать `DashboardSubagent` в агенте и генерацию `output.dashboard` (`RiskDashboardSpec`) на основе ответов `risk-analytics-mcp` для сценариев `portfolio_risk` и `cfo_liquidity_report` | P0.5 | backlog |
| 32 | `TASK-2025-111` | Микро-RAG в сценариях 5/7/9 (FR-KB-MVP-1) | 5/7/9 | Интегрировать `KnowledgeSubagent` и `kb-rag-mcp` в существующие сценарии 5/7/9 как опциональное методическое пояснение метрик риска (FR-KB-MVP-1), не ломая базовый flow при отсутствии RAG | P1 | backlog |
| 33 | `TASK-2025-112` | Голосовой CFO-ассистент для сценариев 7/9 | 7/9 | Реализовать Voice Gateway, подключение ASR (Whisper) и сценарий `voice_cfo_assistant`, который поверх `portfolio_risk` и `cfo_liquidity_report` обеспечивает голосовой ввод и возвращает тот же Risk Dashboard и текст | P2 | backlog |

## 3. Как идти по порядку на практике

1. **Сначала блок P0 (строки 1–18)** — это минимальный сквозной функционал: SDK → `moex-iss-mcp` → `risk-analytics-mcp` (портфельный риск, стрессы, корреляции, фундаментал, peers, ребаланс, CFO-отчёт) → агент и планировщик 5/7/9.
2. **Затем P0.5 (строки 19–22)** — доводим UX и демо: `limit_portfolio`/`scenario_type`, инфраструктура/деплой, Web-UI и сторителлинг.
3. **Далее P1 (строки 23–25)** — расширяем портфельный анализ и пояснительную часть через RAG.
4. **И уже после устойчивого MVP — P2 (строки 26–30)** — продвинутый планировщик, внешний Planner Agent и advanced-риск как дорожная карта.

Используй колонку `#` как основной линейный порядок, а при планировании спринтов можно брать блоками: сначала весь P0, затем P0.5, затем P1 и т.д.
