---
id: TASK-2025-066
title: "Фаза PD.1. SPEC контракта внешнего Planner Agent"
status: backlog
priority: low
type: spike
estimate: 8h
assignee: @unassigned
created: 2025-12-10
updated: 2025-12-10
parents: [TASK-2025-050]
arch_refs: [ARCH-agent-moex-market-analyst]
risk: medium
benefit: "Формализует A2A-контракт внешнего Planner Agent для последующей реализации."
audit_log:
  - {date: 2025-12-10, user: "@AI-DocArchitect", action: "created with status backlog"}
---

## Описание

Подготовить спецификацию (SPEC) вынесенного Planner Agent как отдельного A2A-сервиса: определить формат входа (запрос пользователя, доступные tools, сценарные подсказки, лимиты) и формат выхода (Plan и комментарии по сценарию/деградации).

## Критерии приемки

- В документации (SPEC/ARCHITECTURE) появляется раздел, описывающий внешний Planner Agent:
  - назначение и границы ответственности;
  - структуру входного JSON (user_query, список tools с их схемами, ScenarioTemplates/их метаданные, `planner.limits`, опционально информация о портфеле);
  - структуру выходного JSON (`Plan` в формате, совместимом с внутренней моделью агента, и пояснительный комментарий).
- Описаны требования к соблюдению лимитов (число шагов, LLM-вызовов, бюджет токенов) на стороне Planner Agent и ожидаемое поведение при их нарушении.
- Зафиксированы варианты ошибок Planner Agent и то, как агент должен на них реагировать (fallback в basic-режим, логирование, контролируемый отказ).

## Определение готовности

- Команда разработки может использовать SPEC Planner Agent для оценки трудоёмкости и реализации внешнего сервиса после хакатона.
- Контракт не противоречит текущей внутренней модели `Plan` и стратегиям `PlanningStrategy`.

## Заметки

Реализация самого Planner Agent и интеграция через `ExternalAgentPlanningStrategy` выполняется в соседней подзадаче.
