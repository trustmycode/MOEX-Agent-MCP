# TASK-2025-104: Планировщик P0 на основе шаблонов сценариев (5/7/9)

## Статус

- Статус: planned
- Приоритет: P0
- Компонент: бизнес-агент / Evolution AI Agents
- Связанные сценарии: issuer_peers_compare (5), portfolio_risk (7), cfo_liquidity_report (9)

## Контекст

На хакатоне нужен стабильный, детерминированный планировщик, который всегда проходит демо-скрипты 5/7/9 без сюрпризов. Полноценный PA/PC с критикующим контроллером оставляем в target state.

## Цель

Реализовать P0-планировщик в агенте, основанный на фиксированных `ScenarioTemplate`, который по намерению пользователя выбирает один из сценариев (5/7/9) и последовательно вызывает нужные tools MCP.

## Объём работ

### In scope

- Модель `ScenarioTemplate`:
  - id сценария (5/7/9),
  - входные параметры (тикер, портфель, роль пользователя и т.п.),
  - последовательность шагов (calls к MCP-tools, post-processing, генерация отчёта).
- Маппинг user intent → `ScenarioTemplate`:
  - простые правила/классификатор по промпту и выбранной персоне (риск-менеджер, CFO и т.п.).
- Реализация планировщика:
  - выбор шаблона,
  - последовательное выполнение шагов (1–2 hops максимум),
  - обработка ошибок MCP и возврат осмысленной ошибки пользователю.
- Логирование:
  - запись выбранного сценария и ключевых параметров в лог (для воспроизводимости демо).
- Набор тестовых промптов для регрессионной проверки (чтобы сценарий 7/9 всегда детерминированно выбирался).

### Out of scope

- Динамический self-reflection и replanning.
- Автоматический выбор между несколькими агентами.
- Любая сложная критика или оптимизация плана.

## Acceptance Criteria

- [ ] В коде агента реализована сущность `ScenarioTemplate` и конфигурация шаблонов для 5/7/9.
- [ ] Планировщик на основе intent однозначно выбирает сценарий для типичных формулировок запросов пользователя.
- [ ] Число hops в каждом сценарии жёстко ограничено (для устойчивости и предсказуемости демо).
- [ ] Ошибки MCP аккуратно отображаются пользователю человекочитаемым текстом.
- [ ] Есть набор автотестов/скриптов, прогоняющих демонстрационные запросы по 5/7/9 и проверяющих, что выбирается правильный сценарий.
